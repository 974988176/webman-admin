var M=(n,y,c)=>new Promise((_,C)=>{var v=a=>{try{o(c.next(a))}catch(k){C(k)}},f=a=>{try{o(c.throw(a))}catch(k){C(k)}},o=a=>a.done?_(a.value):Promise.resolve(a.value).then(v,f);o((c=c.apply(n,y)).next())});import{dY as A,k as E,aG as R,a as U,dZ as O,cW as I,dV as V,cT as z,cE as N,aI as d,o as t,h as p,j as w,p as u,t as h,aK as b,F as g,aJ as T,q as m,b2 as G,cH as j,bf as q,x}from"./index.6cd5baf8.js";import{T as H}from"./index.58f2ee69.js";import{S as J}from"./index.7717c432.js";import{T as K}from"./index.be619952.js";import{B as P,u as W}from"./useTable.00bfb386.js";import"./BasicForm.98897bf6.js";import{a as Y,b as S,g as Z}from"./common.c358f0cd.js";import Q from"./Login.f1ee8206.js";import{b as X}from"./index.9b423250.js";import"./transButton.3f533333.js";import"./CopyOutlined.16c771b8.js";import"./index.bd69fa8a.js";import"./useForm.35bc34f9.js";import"./index.441fd29d.js";import"./index.88cadf0e.js";import"./index.2c12ae38.js";import"./index.c21d4698.js";import"./useWindowSizeFn.b111f681.js";import"./useContentViewHeight.8b78d050.js";import"./ArrowLeftOutlined.83dc660b.js";import"./index.45440705.js";import"./_baseIteratee.4c0536c1.js";import"./index.e9e97d48.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.e3536f96.js";import"./FullscreenOutlined.5e472b7c.js";import"./scrollTo.8c68fa0b.js";import"./index.8661fcc6.js";import"./index.b02852d2.js";import"./index.52ee3ac2.js";import"./index.b5298110.js";import"./index.63db07a3.js";import"./uniqBy.7ebdfad5.js";import"./download.8885bb3e.js";import"./index.a4d3410c.js";import"./useLogin.f7a7c7c5.js";function ee(n){let y,c=document.body;if(Reflect.has(n,"target")||Reflect.has(n,"props")){const o=n;y=o.props||{},c=o.target||document.body}else y=n;const _=A(y,void 0,!0);return[()=>{const o=E(c);!o||_.open(o)},()=>{_.close()},o=>{_.setTip(o)}]}const te="/app/admin/plugin/app/list",ne="/app/admin/plugin/app/schema",oe=U({components:{BasicTable:P,Tag:H,Switch:J,ModalLogin:Q,DropdownButton:O,Menu:I,MenuItem:V,DownOutlined:z,TypographyText:K},setup(){const{createMessage:n}=x(),{success:y,error:c}=n,[_,{openModal:C}]=X(),[v,f]=ee({tip:"\u5904\u7406\u4E2D..."});N(()=>M(this,null,function*(){L(yield Y(ne))}));const o=(l,s)=>{a("\u786E\u5B9A\u5378\u8F7D\uFF1F","",function(){B(l,s)})},a=(l,s,e)=>{j.confirm({centered:!0,title:()=>l,icon:()=>w(q),content:()=>w("div",{style:"color:red;"},s),onOk(){e()},class:"test"})};function k(l,s,e){return M(this,null,function*(){if(e!=s){v();try{const i=yield S("/app/admin/plugin/app/install",{name:l,version:s},{timeout:6e4});if(i.code==401){C();return}if(i.code){c(i.message);return}y("\u5B89\u88C5\u6210\u529F"),setTimeout(()=>{location.reload()},1e3)}catch(i){}finally{f()}}})}function B(l,s){return M(this,null,function*(){try{v(),yield S("/app/admin/plugin/app/uninstall",{name:l,version:s})}catch(e){f();return}f(),setTimeout(()=>{location.reload()},1e3),y("\u5378\u8F7D\u6210\u529F")})}function D(l){console.log(l)}const[F,{reload:$,setColumns:L}]=W({api:Z(te),bordered:!0,showTableSetting:!0});return{registerTable:F,reload:$,onStateChanged:D,install:k,uninstall:B,register:_,showConfirmUninstall:o}}}),se={class:"p-4"},ae={key:0,style:{"text-align":"left"}},ie=m("\u514D\u8D39"),le=m("\u5378\u8F7D"),pe=m("\u5B89\u88C5");function ue(n,y,c,_,C,v){const f=d("Tag"),o=d("Switch"),a=d("TypographyText"),k=d("a-button"),B=d("MenuItem"),D=d("Menu"),F=d("DownOutlined"),$=d("DropdownButton"),L=d("BasicTable"),l=d("ModalLogin");return t(),p("div",se,[w(L,{onRegister:n.registerTable},{bodyCell:u(({column:s,record:e,text:i})=>[s.key==="title"?(t(),p("div",ae,h(i),1)):b("",!0),s.key==="author"?(t(),p(g,{key:1},[i==="\u5B98\u65B9"?(t(),T(f,{key:0,color:"green"},{default:u(()=>[m(h(i),1)]),_:2},1024)):(t(),p(g,{key:1},[m(h(i),1)],64))],64)):b("",!0),s.key==="state"?(t(),T(o,{key:2,"checked-children":"\u5F00\u542F","un-checked-children":"\u7981\u7528","default-checked":"",class:"extra",checked:e.state,"onUpdate:checked":r=>e.state=r,onChange:r=>n.onStateChanged(e)},null,8,["checked","onUpdate:checked","onChange"])):b("",!0),s.key==="version"?(t(),p(g,{key:3},[e.installed?(t(),p(g,{key:0},[m(h(e.installed),1)],64)):(t(),p(g,{key:1},[m(h(i),1)],64))],64)):b("",!0),s.key==="price"?(t(),p(g,{key:4},[i==0?(t(),T(a,{key:0,type:"success"},{default:u(()=>[ie]),_:1})):(t(),T(a,{key:1,type:"danger"},{default:u(()=>[m(h(i)+"\xA5",1)]),_:2},1024))],64)):b("",!0),s.key==="installed"?(t(),p(g,{key:5},[e.installed?(t(),p(g,{key:0},[e.name!=="admin"?(t(),T(k,{key:0,type:"danger",size:"small",disabled:e.disabled,onClick:r=>n.showConfirmUninstall(e.name,e.installed)},{default:u(()=>[le]),_:2},1032,["disabled","onClick"])):b("",!0)],64)):(t(),T(k,{key:1,type:"success",disabled:e.disabled,size:"small",onClick:r=>n.install(e.name,e.version)},{default:u(()=>[pe]),_:2},1032,["disabled","onClick"])),e.installed&&e.releases&&e.releases.length>1?(t(),T($,{key:2,onClick:r=>n.install(e.name,e.version,e.installed),size:"small",type:e.version===e.installed?"info":"success",disabled:e.disabled},{overlay:u(()=>[w(D,null,{default:u(()=>[(t(!0),p(g,null,G(e.releases,r=>(t(),T(B,{key:r,disabled:r===e.installed,onClick:ce=>n.install(e.name,r,e.installed)},{default:u(()=>[m(h(r),1)]),_:2},1032,["disabled","onClick"]))),128))]),_:2},1024)]),icon:u(()=>[w(F)]),default:u(()=>[m(h(e.version===e.installed?"\u964D\u7EA7":"\u5347\u7EA7")+" ",1)]),_:2},1032,["onClick","type","disabled"])):b("",!0)],64)):b("",!0)]),_:1},8,["onRegister"]),w(l,{onRegister:n.register,height:350,width:450},null,8,["onRegister"])])}var Pe=R(oe,[["render",ue]]);export{Pe as default};
