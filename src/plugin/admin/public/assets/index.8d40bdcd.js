var b=(t,f,a)=>new Promise((s,c)=>{var m=o=>{try{n(a.next(o))}catch(i){c(i)}},p=o=>{try{n(a.throw(o))}catch(i){c(i)}},n=o=>o.done?s(o.value):Promise.resolve(o.value).then(m,p);n((a=a.apply(t,f)).next())});import{B as k,u as A}from"./useTable.4a8940b2.js";import{x as I}from"./BasicForm.6307abba.js";import{a as P,g as x,b as D}from"./common.548a9d5e.js";import{b as $}from"./index.c145b0a3.js";import S from"./Update.706a84ea.js";import{aG as U,r as w,a as O,cE as N,ac as G,aI as _,o as H,h as V,j as v,p as F,dJ as j,cx as E,q,x as J}from"./index.b9fee3a3.js";import{t as K}from"./util.2d047e79.js";import"./index.95528ccd.js";import"./useForm.227e0302.js";import"./index.d59f5842.js";import"./index.03099132.js";import"./index.160bb7ff.js";import"./index.aef99e85.js";import"./useWindowSizeFn.3f9c25fc.js";import"./useContentViewHeight.f0a3445d.js";import"./ArrowLeftOutlined.e8e17a10.js";import"./transButton.fd1aef61.js";import"./index.20ed4699.js";import"./index.befee6b0.js";import"./index.c8f8cc06.js";import"./_baseIteratee.645293d8.js";import"./index.ab875217.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.ae09e885.js";import"./FullscreenOutlined.1c83f2c7.js";import"./scrollTo.e8ab4bb8.js";import"./index.0b010304.js";import"./index.087365a2.js";import"./index.efad70d8.js";import"./index.1e6e3f04.js";import"./index.44110336.js";import"./uniqBy.1d81fed5.js";import"./download.d7c230f8.js";import"./index.24b5a242.js";const g="/app/admin/user/user/select",T="/app/admin/user/user/insert",B="/app/admin/user/user/update",z="/app/admin/user/user/delete",C="/app/admin/user/user/schema",u=w({schemas:[]}),L=O({components:{ModalInserOrEdit:S,BasicTable:k,TableAction:I},setup(){const{createMessage:t}=J(),{success:f}=t,a=w([]),s=w("");N(()=>b(this,null,function*(){const l=yield P(C),M=l.columns;for(let e of M)if(e.primary_key){s.value=e.field;break}const R=l.forms;u.value.schemas=[];for(let e of R){if(e.searchable){let[r,d]=K(e,"","search");e.search_type=="between"?(u.value.schemas.push({field:`${e.field}[0]`,component:r,label:e.comment||e.field,colProps:{offset:1,span:5},componentProps:d}),u.value.schemas.push({field:`${e.field}[1]`,component:r,label:"\u3000\u5230",colProps:{span:5},componentProps:d})):u.value.schemas.push({field:e.field,component:r,label:e.comment||e.field,colProps:{offset:1,span:10},componentProps:d})}if(e.list_show){let r={dataIndex:e.field,title:e.comment||e.field,sorter:e.enable_sort,defaultHidden:!e.list_show};["InputNumber","Switch"].indexOf(e.control)!=-1&&(r.width=120),e.field=="avatar"&&(r.width=50,r.customRender=({record:d})=>j("img",{src:d[e.field]})),a.value.push(r)}}u.value.schemas.length||G(()=>{o({useSearchForm:!1})})}));const[c,{openModal:m}]=$(),[p,{reload:n,setProps:o}]=A({api:x(g),columns:a,useSearchForm:!0,bordered:!0,formConfig:u,actionColumn:{width:250,title:"Action",dataIndex:"action",slots:{customRender:"action"}}});function i(l){return b(this,null,function*(){if(!s.value){E("\u5F53\u524D\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u65E0\u6CD5\u7F16\u8F91");return}m(!0,{selectUrl:g,insertUrl:T,updateUrl:B,schemaUrl:C,column:s.value,value:l[s.value]})})}function h(l){return b(this,null,function*(){if(!s.value){E("\u5F53\u524D\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u65E0\u6CD5\u5220\u9664");return}yield D(z,{column:s.value,value:l[s.value]}),f("\u5220\u9664\u6210\u529F"),n()})}function y(){m(!0,{selectUrl:g,insertUrl:T,updateUrl:B,schemaUrl:C})}return{registerTable:p,handleEdit:i,handleDelete:h,openRowModal:y,register:c,reload:n}}}),Q={class:"p-4"},W=q(" \u6DFB\u52A0\u8BB0\u5F55 ");function X(t,f,a,s,c,m){const p=_("a-button"),n=_("TableAction"),o=_("BasicTable"),i=_("ModalInserOrEdit");return H(),V("div",Q,[v(o,{onRegister:t.registerTable,showTableSetting:""},{toolbar:F(()=>[v(p,{type:"primary",onClick:t.openRowModal},{default:F(()=>[W]),_:1},8,["onClick"])]),action:F(({record:h})=>[v(n,{actions:[{label:"\u7F16\u8F91",onClick:t.handleEdit.bind(null,h)},{label:"\u5220\u9664",icon:"ic:outline-delete-outline",popConfirm:{title:"\u662F\u5426\u5220\u9664\uFF1F",confirm:t.handleDelete.bind(null,h)}}]},null,8,["actions"])]),_:1},8,["onRegister"]),v(i,{onRegister:t.register,minHeight:300,onReload:t.reload},null,8,["onRegister","onReload"])])}var xe=U(L,[["render",X]]);export{xe as default};
