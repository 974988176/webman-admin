var B=(r,p,a)=>new Promise((f,n)=>{var u=l=>{try{i(a.next(l))}catch(c){n(c)}},e=l=>{try{i(a.throw(l))}catch(c){n(c)}},i=l=>l.done?f(l.value):Promise.resolve(l.value).then(u,e);i((a=a.apply(r,p)).next())});import{B as R}from"./BasicForm.6307abba.js";import{B as G,a as V}from"./index.c145b0a3.js";import{aG as N,r as s,a as j,aI as g,o as q,aJ as J,p as T,i as W,j as x,b5 as z,x as H}from"./index.b9fee3a3.js";import{a as C,b as M}from"./common.548a9d5e.js";import{t as K}from"./util.2d047e79.js";import"./index.efad70d8.js";import"./index.aef99e85.js";import"./_baseIteratee.645293d8.js";import"./index.ab875217.js";import"./index.95528ccd.js";import"./index.c8f8cc06.js";import"./index.20ed4699.js";import"./index.befee6b0.js";import"./index.1e6e3f04.js";import"./index.44110336.js";import"./uniqBy.1d81fed5.js";import"./download.d7c230f8.js";import"./index.24b5a242.js";import"./useWindowSizeFn.3f9c25fc.js";import"./FullscreenOutlined.1c83f2c7.js";const h=s(null),U=s(""),y=s(""),E=s(""),S=s(""),L=j({components:{BasicForm:R,BasicModal:G},emits:["reload","register"],setup(r,{emit:p}){const a=s("\u6DFB\u52A0\u8BB0\u5F55"),f=s(""),n=s(""),u=s(""),e=s("insert"),i=[],[l,{closeModal:c}]=V(t=>B(this,null,function*(){n.value=t.column,u.value=t.value,f.value=t.table,U.value=t.selectUrl,y.value=t.insertUrl,E.value=t.updateUrl,S.value=t.schemaUrl,n.value?(e.value="edit",a.value="\u7F16\u8F91\u8BB0\u5F55"):(e.value="insert",a.value="\u63D2\u5165\u8BB0\u5F55");const m=yield C(S.value),A=m.forms,D=m.columns,d={};for(let o of D)d[o.field]=o;const v=h.value;if(!v)return;yield v.resetSchema([]);const F={};F[n.value]=u.value;const b=e.value=="edit"?yield C(U.value,F):{},I=e.value=="edit"&&b.items.length?b.items[0]:{};for(let o of A){if(!o.form_show)continue;let O=e.value=="edit"?I[o.field]:d[o.field].default,[P,w,_]=K(o,O,e.value);o.field=="password"&&(_="",e.value=="edit"&&(w={placeholder:"\u4E0D\u66F4\u65B0\u5BC6\u7801\u8BF7\u7559\u7A7A"})),v.appendSchemaByField({field:o.field,component:P,label:o.comment||o.field,colProps:{span:24},required:e.value=="edit"&&o.field=="password"?!1:!d[o.field].nullable,componentProps:w,defaultValue:_},"")}})),{createMessage:$}=H(),{success:k}=$;return{formElRef:h,handleSubmit:()=>B(this,null,function*(){try{const t=h.value;if(!t)return;const m=yield t.validate();e.value=="edit"?yield M(E.value,{column:n.value,value:u.value,data:m}):yield M(y.value,{data:m}),c(),k("\u64CD\u4F5C\u6210\u529F"),p("reload")}catch(t){console.log(t)}}),schemas:i,register:l,title:a}}}),Q={class:"mt-3"};function X(r,p,a,f,n,u){const e=g("BasicForm"),i=g("BasicModal");return q(),J(i,z(r.$attrs,{destroyOnClose:"",onRegister:r.register,title:r.title,onOk:r.handleSubmit}),{default:T(()=>[W("div",Q,[x(e,{schemas:r.schemas,ref:"formElRef",labelWidth:75,showActionButtonGroup:!1},null,8,["schemas"])])]),_:1},16,["onRegister","title","onOk"])}var we=N(L,[["render",X]]);export{we as default};
