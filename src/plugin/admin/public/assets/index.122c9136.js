var f=(t,p,n)=>new Promise((a,u)=>{var c=o=>{try{s(n.next(o))}catch(i){u(i)}},m=o=>{try{s(n.throw(o))}catch(i){u(i)}},s=o=>o.done?a(o.value):Promise.resolve(o.value).then(c,m);s((n=n.apply(t,p)).next())});import{B as R,u as k}from"./useTable.885579ec.js";import{T as A}from"./BasicForm.948b0243.js";import{a as D,g as P,b as $}from"./common.201fe4f0.js";import{b as x}from"./index.4b403226.js";import U from"./Update.de77965e.js";import{aH as S,r as C,a as O,cE as H,ac as J,aJ as h,o as N,h as V,j as b,p as F,dJ as j,cb as q,cx as T,q as G,x as K}from"./index.bde7963b.js";import"./index.dcd3d2b7.js";import"./useForm.b21b423d.js";import"./index.159e9c7d.js";import"./index.e3e2a44d.js";import"./index.eb76ac7f.js";import"./index.3289c967.js";import"./index.18602d99.js";import"./useWindowSizeFn.ada338ad.js";import"./useContentViewHeight.9a4f8bdd.js";import"./ArrowLeftOutlined.284f8ef3.js";import"./transButton.3496299b.js";import"./index.bfd670f8.js";import"./index.13318916.js";import"./_baseIteratee.34b68bfe.js";import"./index.9b1e5ec7.js";import"./sortable.esm.2632adaa.js";import"./RedoOutlined.4aa527e6.js";import"./uniqBy.3333e3da.js";import"./fromPairs.84aabb58.js";import"./scrollTo.7893ea05.js";import"./index.54dd68f7.js";import"./index.498edf7f.js";import"./index.0103b3aa.js";import"./index.ce7c5e55.js";import"./index.b75cc0a1.js";import"./download.dc299cb5.js";import"./tree.36c6ae32.js";const v="/app/admin/auth/adminrule/select",E="/app/admin/auth/adminrule/insert",B="/app/admin/auth/adminrule/update",z="/app/admin/auth/adminrule/delete",g="/app/admin/auth/adminrule/schema",l=C({schemas:[]}),L=O({components:{ModalInserOrEdit:U,BasicTable:R,TableAction:A},setup(){const{createMessage:t}=K(),{success:p}=t,n=C([]),a=C("");H(()=>f(this,null,function*(){const r=yield D(g),w=r.columns;for(let e of w)if(e.primary_key){a.value=e.field;break}const y=r.forms;l.value.schemas=[];for(let e of y)if(e.searchable&&(e.search_type=="between"?(l.value.schemas.push({field:`${e.field}[0]`,component:"Input",label:e.comment||e.field,colProps:{offset:1,span:5}}),l.value.schemas.push({field:`${e.field}[1]`,component:"Input",label:"\u3000\u5230",colProps:{span:5}})):l.value.schemas.push({field:e.field,component:"Input",label:e.comment||e.field,colProps:{offset:1,span:10}})),e.list_show){let _={dataIndex:e.field,title:e.comment||e.field,sorter:e.enable_sort};e.control=="IconPicker"&&(_.width=50,_.customRender=({record:M})=>j(q,{icon:M[e.field]})),n.value.push(_)}l.value.schemas.length||J(()=>{o({useSearchForm:!1})})}));const[u,{openModal:c}]=x(),[m,{reload:s,setProps:o}]=k({api:P(v,{format:"table_tree"}),columns:n,useSearchForm:!0,bordered:!0,isTreeTable:!0,formConfig:l,pagination:!1,actionColumn:{width:250,title:"Action",dataIndex:"action",slots:{customRender:"action"}}});function i(r){return f(this,null,function*(){if(!a.value){T("\u5F53\u524D\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u65E0\u6CD5\u7F16\u8F91");return}c(!0,{selectUrl:v,insertUrl:E,updateUrl:B,schemaUrl:g,column:a.value,value:r[a.value]})})}function d(r){return f(this,null,function*(){if(!a.value){T("\u5F53\u524D\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u65E0\u6CD5\u5220\u9664");return}yield $(z,{column:a.value,value:r[a.value]}),p("\u5220\u9664\u6210\u529F"),s()})}function I(){c(!0,{selectUrl:v,insertUrl:E,updateUrl:B,schemaUrl:g})}return{registerTable:m,handleEdit:i,handleDelete:d,openRowModal:I,register:u,reload:s}}}),Q={class:"p-4"},W=G(" \u6DFB\u52A0\u8BB0\u5F55 ");function X(t,p,n,a,u,c){const m=h("a-button"),s=h("TableAction"),o=h("BasicTable"),i=h("ModalInserOrEdit");return N(),V("div",Q,[b(o,{onRegister:t.registerTable,showTableSetting:""},{toolbar:F(()=>[b(m,{type:"primary",onClick:t.openRowModal},{default:F(()=>[W]),_:1},8,["onClick"])]),action:F(({record:d})=>[b(s,{actions:[{label:"\u7F16\u8F91",onClick:t.handleEdit.bind(null,d)},{label:"\u5220\u9664",icon:"ic:outline-delete-outline",popConfirm:{title:"\u662F\u5426\u5220\u9664\uFF1F",confirm:t.handleDelete.bind(null,d)}}]},null,8,["actions"])]),_:1},8,["onRegister"]),b(i,{onRegister:t.register,minHeight:300,onReload:t.reload},null,8,["onRegister","onReload"])])}var De=S(L,[["render",X]]);export{De as default};
