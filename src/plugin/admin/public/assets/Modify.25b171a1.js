var C=(c,j,k)=>new Promise((I,T)=>{var W=f=>{try{m(k.next(f))}catch(F){T(F)}},$=f=>{try{m(k.throw(f))}catch(F){T(F)}},m=f=>f.done?I(f.value):Promise.resolve(f.value).then(W,$);m((k=k.apply(c,j)).next())});import{aP as re,r as P,a as de,I as Z,dw as pe,ab as E,aQ as G,o as g,aR as S,p as v,i as t,j as M,w as Q,v as U,aU as x,q as i,x as me}from"./index.0d073eaa.js";import{B as fe}from"./BasicForm.d11b68fd.js";import{C as he}from"./index.abdcab42.js";import"./index.78efd931.js";/* empty css              */import{S as be}from"./index.81899e8a.js";import{B as ve,a as ye}from"./index.c05f9254.js";import{defaultTableSchemas as Be,fieldSchemas as V,getDefaultFieldSchemas as _e,defaultKeySchemas as A,controlSelectOptions as $e,typeToControl as Ce}from"./tableData.d0a972e1.js";import{T as Y}from"./table.0ba2e59f.js";import{a as Ee,b as ee}from"./common.f56e6fca.js";/* empty css              */import"./index.0fb15725.js";import"./index.965098be.js";import"./Checkbox.476f6e92.js";import"./index.1491cab6.js";import"./index.e317a008.js";import"./index.7075e2b7.js";import"./index.04f7e044.js";import"./index.e8daa066.js";import"./get.49a42f2e.js";import"./index.e8b360cf.js";import"./eagerComputed.156e81ff.js";import"./index.2b5ea4f6.js";import"./_baseIteratee.3919e7cf.js";import"./DeleteOutlined.247d1f35.js";import"./index.a8c197b8.js";import"./useRefs.e81831e2.js";import"./Form.48352728.js";import"./Col.a2eadc78.js";import"./useFlexGapSupport.474c31b7.js";import"./useSize.bb4e5ce5.js";import"./index.ffb8ac7d.js";import"./index.dd1f987c.js";import"./uuid.2b29000c.js";import"./download.bb4c9304.js";import"./base64Conver.08b9f4ec.js";import"./index.31930d74.js";import"./index.1d29734e.js";import"./uniqBy.ac0f9c38.js";import"./index.aa6b7013.js";import"./PlusOutlined.64d8e001.js";import"./useWindowSizeFn.ef20ece8.js";import"./FullscreenOutlined.401a7bcd.js";const z=P(null),R=P(null),L=P(null),O=P(null);let y="",H=[],N=[],_={};const w=P(3),D=P(0),ke=de({components:{BasicForm:fe,[Z.name]:Z,Button:pe,Card:he,BasicModal:ve,Space:be},emits:["reload","register"],setup(c,{emit:j}){const[k,{closeModal:I}]=ye(o=>C(this,null,function*(){y=o?o.table:"",console.log(".....",y);const a=y?yield Ee(Y.SCHEMA,{table:y}):{table:{}};H=[];for(let r of Be){let p=E(r);if(p.defaultValue=a.table[p.field]||"",y&&p.field=="name"){let h=E(p);h.field="old_name",h.componentProps={hidden:!0},h.colProps={span:0},h.label="",H.push(h)}H.push(p)}const e=z.value;if(e==null||e.resetSchema(H),N=[],y)for(let r in a.columns){let p=a.columns[r];for(let h in V){let d=E(V[h]),s=d.field;if(d.defaultValue=p[s],s==="field"){let u=E(d);u.field=`old_${s}[${r}]`,u.label="",u.colProps={span:0},u.componentProps={hidden:!0},N.push(u)}d.field=d.slot?`${r}`:`${s}[${r}]`,N.push(d),w.value=Number(r)+1}}else N=_e();const l=R.value;if(l==null||l.resetSchema(N),y)for(let r in a.forms){let p=a.forms[r];_[p.field]=p}const n=O.value;n==null||n.resetSchema([]);const B=[];if(y)for(let r in a.keys){let p=a.keys[r];for(let h in A){let d=E(A[h]),s=d.field;if(d.defaultValue=p[s],y&&s==="name"){let u=E(d);u.field=`old_${s}[${r}]`,u.label="",u.colProps={span:0},u.componentProps={hidden:!0},B.push(u)}d.field=d.slot?`${r}`:`${s}[${r}]`,B.push(d),D.value=Number(r)+1}}if(n==null||n.resetSchema(B),n){const r=yield n.validate();Object.keys(r).length||q()}J()})),T=P("fieldTab"),{createMessage:W}=me(),{success:$}=W,m=[{key:"fieldTab",tab:"\u5B57\u6BB5\u5C5E\u6027"},{key:"formTab",tab:"\u8868\u5355\u5C5E\u6027"},{key:"keyTab",tab:"\u7D22\u5F15"}];function f(o){return C(this,null,function*(){if(T.value=o,o==="formTab"){J();return}if(o=="keyTab"){const e=O.value;if(!e)return;const l=yield e.validate();Object.keys(l).length||q()}const a=yield K();for(let e of a)_[e.field]=e})}function F(){f("fieldTab")}function b(){return C(this,null,function*(){const o=R.value;if(!o)return[];const a=[];let e=-1;const l=yield o.validate();for(;e<Object.keys(l).length;)e++,l[`field[${e}]`]&&a.push({old_field:l[`old_field[${e}]`],field:l[`field[${e}]`],type:l[`type[${e}]`],comment:l[`comment[${e}]`]||null,length:l[`length[${e}]`]||null,default:l[`default[${e}]`]||null,nullable:l[`nullable[${e}]`]||!1,primary_key:l[`primary_key[${e}]`]||!1,auto_increment:l[`auto_increment[${e}]`]||!1});return a})}function K(){return C(this,null,function*(){const o=L.value;if(!o)return[];const a=[];let e=-1;const l=yield o.validate();for(;e<Object.keys(l).length;)e++,l[`field[${e}]`]&&a.push({field:l[`field[${e}]`],comment:l[`comment[${e}]`]||null,control:l[`control[${e}]`]||null,form_show:!!l[`form_show[${e}]`],list_show:!!l[`list_show[${e}]`],enable_sort:!!l[`enable_sort[${e}]`],readonly:!!l[`readonly[${e}]`],searchable:!!l[`searchable[${e}]`],search_type:l[`search_type[${e}]`]||"normal",control_args:l[`control_args[${e}]`]||null});return a})}function le(){return C(this,null,function*(){const o=O.value;if(!o)return[];const a=[];let e=-1;const l=yield o.validate();for(console.log(l);e<Object.keys(l).length;)e++,l[`name[${e}]`]&&a.push({old_name:l[`old_name[${e}]`]||null,name:l[`name[${e}]`],columns:l[`columns[${e}]`]||null,type:l[`type[${e}]`]||null});return a})}function J(){var l,n,B,r,p,h,d;const o=L.value,a=R.value;if(!o||!a)return;const e=a.getFieldsValue();o.resetSchema([]);for(let s in e.field){let u=e.field[s],ie=e.comment[s],X=e.type[s],ue=e.primary_key[s],ce=e.length[s];o.appendSchemaByField({field:`old_field[${s}]`,component:"Input",label:" ",colProps:{span:0},defaultValue:u,componentProps:{disabled:!0,hidden:!0}},""),o.appendSchemaByField({field:`field[${s}]`,component:"Input",label:" ",colProps:{span:4},defaultValue:u,componentProps:{disabled:!0}},""),o.appendSchemaByField({field:`comment[${s}]`,component:"Input",label:" ",colProps:{span:4},defaultValue:ie,componentProps:{disabled:!0}},""),o.appendSchemaByField({field:`control[${s}]`,component:"Select",label:" ",colProps:{span:4},required:!0,componentProps:{options:$e},defaultValue:((l=_[u])==null?void 0:l.control)||Ce(X)},""),o.appendSchemaByField({field:`form_show[${s}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:ue?!1:(n=_[u])==null?void 0:n.form_show},""),o.appendSchemaByField({field:`list_show[${s}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:!0},""),o.appendSchemaByField({field:`enable_sort[${s}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:((B=_[u])==null?void 0:B.enable_sort)||!1},""),o.appendSchemaByField({field:`readonly[${s}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:((r=_[u])==null?void 0:r.readonly)||!1},""),o.appendSchemaByField({field:`searchable[${s}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:((p=_[u])==null?void 0:p.searchable)||!1},""),o.appendSchemaByField({field:`search_type[${s}]`,component:"Select",label:" ",colProps:{span:2},componentProps:{options:[{label:"\u666E\u901A\u67E5\u8BE2",value:"normal"},{label:"\u8303\u56F4\u67E5\u8BE2",value:"between"}]},defaultValue:((h=_[u])==null?void 0:h.search_type)||"\u666E\u901A\u67E5\u8BE2"},""),o.appendSchemaByField({field:`control_args[${s}]`,component:"Input",label:" ",colProps:{span:4},componentProps:{placeholder:""},defaultValue:((d=_[u])==null?void 0:d.control_args)||oe(X,ce)},"")}}const oe=(o,a)=>{if(o=="enum"){let e=[];for(let l of a.split(","))e.push(l+":"+l);return e.join(",")}return""},te=()=>C(this,null,function*(){try{const o=z.value,a=L.value;if(!o||!a)return;const e=yield o.validate(),l=yield b(),n=yield K(),B=yield le();y?yield ee(Y.MODIFY,{table:e,columns:l,forms:n,keys:B}):yield ee(Y.CREATE,{table:e,columns:l,forms:n,keys:B}),I(),$("\u64CD\u4F5C\u6210\u529F"),j("reload")}catch(o){console.log(o)}});function ae(){const o=R.value;if(!!o){for(let a in V){let e=E(V[a]);e.field=e.field==="0"?String(w.value):`${e.field}[${w.value}]`,o.appendSchemaByField(e,"")}w.value++,console.log(w.value)}}function ne(o){const a=R.value;if(!a)return;const e=[];for(let l in V){let n=V[l];e.push(n.field=="0"?String(o):`${n.field}[${o}]`)}a.removeSchemaByFiled(e),w.value--,console.log(w.value)}function q(){return C(this,null,function*(){const o=O.value;if(!o)return;const a=yield b(),e=[];for(let l of a)console.log(l),e.push({label:l.field,value:l.field});for(let l in A){let n=E(A[l]);n.field==="columns"&&n.componentProps&&(n.componentProps.options=e),n.field=n.field==="0"?String(D.value):`${n.field}[${D.value}]`,o.appendSchemaByField(n,"")}D.value++})}function se(o){const a=O.value;if(!a)return;const e=[];for(let l in A){let n=A[l];e.push(n.field=="0"?String(o):`${n.field}[${o}]`)}a.removeSchemaByFiled(e),D.value--,D.value<0&&q()}return{tableElRef:z,fieldElRef:R,formElRef:L,keyElRef:O,handleSubmit:te,tabListTitle:m,onTabChange:f,onTabClose:F,activeKey:T,del:ne,add:ae,addKey:q,delKey:se,register:k}}}),Fe={class:"mt-3"},ge=t("div",{class:"ant-row pb-2 b"},[t("div",{class:"ant-col-4 pl-2 align-center"}," \u5B57\u6BB5"),t("div",{class:"ant-col-4"}," \u5907\u6CE8"),t("div",{class:"ant-col-3 pl-2"},"\u957F\u5EA6/\u503C"),t("div",{class:"ant-col-4 pl-2"},"\u9ED8\u8BA4\u503C"),t("div",{class:"ant-col-4 pl-2"},"\u7C7B\u578B"),t("div",{class:"ant-col-1"},"\u4E3B\u952E"),t("div",{class:"ant-col-1"},"\u81EA\u589E"),t("div",{class:"ant-col-1"},"\u5141\u8BB8\u7A7A"),t("div",{class:"ant-col-2 pl-2"},"\u64CD\u4F5C")],-1),Se=i("+"),we=i("-"),Pe=t("div",{class:"ant-row pb-2 b"},[t("div",{class:"ant-col-4 pl-2"},[t("br"),i("\u5B57\u6BB5")]),t("div",{class:"ant-col-4"},[t("br"),i("\u5907\u6CE8")]),t("div",{class:"ant-col-4 pl-2"},[t("br"),i("\u63A7\u4EF6\u7C7B\u578B")]),t("div",{class:"ant-col-1 pl-2"},[i("\u8868\u5355"),t("br"),i("\u663E\u793A")]),t("div",{class:"ant-col-1 pl-2"},[i("\u5217\u8868"),t("br"),i("\u663E\u793A")]),t("div",{class:"ant-col-1"},[i("\u652F\u6301"),t("br"),i("\u6392\u5E8F")]),t("div",{class:"ant-col-1"},[i("\u662F\u5426"),t("br"),i("\u53EA\u8BFB")]),t("div",{class:"ant-col-1"},[i("\u662F\u5426"),t("br"),i("\u67E5\u8BE2")]),t("div",{class:"ant-col-2 pl-2"},[t("br"),i("\u67E5\u8BE2\u7C7B\u578B")]),t("div",{class:"ant-col-4 pl-2"},[t("br"),i("\u63A7\u4EF6\u53C2\u6570")])],-1),Te=i("+"),Ve=i("-"),Ae=t("div",{class:"ant-row pb-2 b"},[t("div",{class:"ant-col-6 pl-2"},[t("br"),i("\u7D22\u5F15\u540D\u79F0")]),t("div",{class:"ant-col-6"},[t("br"),i("\u7D22\u5F15\u5B57\u6BB5")]),t("div",{class:"ant-col-6 pl-2"},[t("br"),i("\u7D22\u5F15\u7C7B\u578B")])],-1),Re=i("+"),Oe=i("-");function De(c,j,k,I,T,W){const $=G("BasicForm"),m=G("Button"),f=G("Card"),F=G("BasicModal");return g(),S(F,x(c.$attrs,{destroyOnClose:"",onRegister:c.register,title:"\u4FEE\u6539\u8868",helpMessage:["\u4FEE\u6539\u8868"],onOk:c.handleSubmit,afterClose:c.onTabClose}),{default:v(()=>[t("div",Fe,[M($,{ref:"tableElRef",labelWidth:75,showActionButtonGroup:!1},null,512)]),M(f,x({"tab-list":c.tabListTitle},c.$attrs,{"active-tab-key":c.activeKey,onTabChange:c.onTabChange}),{default:v(()=>[Q(t("div",null,[ge,M($,{ref:"fieldElRef",labelWidth:10,actionColOptions:{span:24},showResetButton:!1,showSubmitButton:!1},{add:v(({field:b})=>[Number(b)===0?(g(),S(m,{key:0,onClick:c.add},{default:v(()=>[Se]),_:1},8,["onClick"])):(g(),S(m,{key:1,onClick:K=>c.del(b)},{default:v(()=>[we]),_:2},1032,["onClick"]))]),_:1},512)],512),[[U,c.activeKey==="fieldTab"]]),Q(t("div",null,[Pe,M($,{ref:"formElRef",labelWidth:10,actionColOptions:{span:24},showResetButton:!1,showSubmitButton:!1},{add:v(({field:b})=>[Number(b)===0?(g(),S(m,{key:0,onClick:c.add},{default:v(()=>[Te]),_:1},8,["onClick"])):(g(),S(m,{key:1,onClick:K=>c.del(b)},{default:v(()=>[Ve]),_:2},1032,["onClick"]))]),_:1},512)],512),[[U,c.activeKey==="formTab"]]),Q(t("div",null,[Ae,M($,{ref:"keyElRef",labelWidth:10,actionColOptions:{span:24},showResetButton:!1,showSubmitButton:!1},{add:v(({field:b})=>[Number(b)===0?(g(),S(m,{key:0,onClick:c.addKey},{default:v(()=>[Re]),_:1},8,["onClick"])):(g(),S(m,{key:1,onClick:K=>c.delKey(b)},{default:v(()=>[Oe]),_:2},1032,["onClick"]))]),_:1},512)],512),[[U,c.activeKey==="keyTab"]])]),_:1},16,["tab-list","active-tab-key","onTabChange"])]),_:1},16,["onRegister","onOk","afterClose"])}var gl=re(ke,[["render",De]]);export{gl as default};
