var b=(t,p,n)=>new Promise((a,u)=>{var m=o=>{try{s(n.next(o))}catch(r){u(r)}},c=o=>{try{s(n.throw(o))}catch(r){u(r)}},s=o=>o.done?a(o.value):Promise.resolve(o.value).then(m,c);s((n=n.apply(t,p)).next())});import{B as k,u as A}from"./useTable.4a8940b2.js";import{x as P}from"./BasicForm.6307abba.js";import{a as x,g as D,b as $}from"./common.548a9d5e.js";import{b as S}from"./index.c145b0a3.js";import U from"./Update.c1b7c055.js";import{aG as O,r as T,a as N,cE as G,ac as H,aI as _,o as V,h as j,j as v,p as g,dJ as q,cx as w,q as J,x as K}from"./index.b9fee3a3.js";import{t as z}from"./util.2d047e79.js";import"./index.95528ccd.js";import"./useForm.227e0302.js";import"./index.d59f5842.js";import"./index.03099132.js";import"./index.160bb7ff.js";import"./index.aef99e85.js";import"./useWindowSizeFn.3f9c25fc.js";import"./useContentViewHeight.f0a3445d.js";import"./ArrowLeftOutlined.e8e17a10.js";import"./transButton.fd1aef61.js";import"./index.20ed4699.js";import"./index.befee6b0.js";import"./index.c8f8cc06.js";import"./_baseIteratee.645293d8.js";import"./index.ab875217.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.ae09e885.js";import"./FullscreenOutlined.1c83f2c7.js";import"./scrollTo.e8ab4bb8.js";import"./index.0b010304.js";import"./index.087365a2.js";import"./index.efad70d8.js";import"./index.1e6e3f04.js";import"./index.44110336.js";import"./uniqBy.1d81fed5.js";import"./download.d7c230f8.js";import"./index.24b5a242.js";const C="/app/admin/auth/adminrole/select",B="/app/admin/auth/adminrole/insert",y="/app/admin/auth/adminrole/update",L="/app/admin/auth/adminrole/delete",E="/app/admin/auth/adminrole/schema",l=T({schemas:[]}),Q=N({components:{ModalInserOrEdit:U,BasicTable:k,TableAction:P},setup(){const{createMessage:t}=K(),{success:p}=t,n=T([]),a=T("");G(()=>b(this,null,function*(){const i=yield x(E),R=i.columns;for(let e of R)if(e.primary_key){a.value=e.field;break}const I=i.forms;l.value.schemas=[];for(let e of I){if(e.searchable){let[h,F]=z(e,"","search");e.search_type=="between"?(l.value.schemas.push({field:`${e.field}[0]`,component:h,label:e.comment||e.field,colProps:{offset:1,span:5},componentProps:F}),l.value.schemas.push({field:`${e.field}[1]`,component:h,label:"\u3000\u5230",colProps:{span:5},componentProps:F})):l.value.schemas.push({field:e.field,component:"Input",label:e.comment||e.field,colProps:{offset:1,span:10},componentProps:F})}let f={dataIndex:e.field,title:e.comment||e.field,sorter:e.enable_sort,defaultHidden:!e.list_show};["InputNumber","Switch"].indexOf(e.control)!=-1&&(f.width=120),e.field=="avatar"&&(f.width=50,f.customRender=({record:h})=>q("img",{src:h[e.field]})),n.value.push(f)}H(()=>{l.value.schemas.length||o({useSearchForm:!1})})}));const[u,{openModal:m}]=S(),[c,{reload:s,setProps:o}]=A({api:D(C),columns:n,useSearchForm:!0,bordered:!0,formConfig:l,actionColumn:{width:250,title:"Action",dataIndex:"action",slots:{customRender:"action"}}});function r(i){return b(this,null,function*(){if(!a.value){w("\u5F53\u524D\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u65E0\u6CD5\u7F16\u8F91");return}m(!0,{selectUrl:C,insertUrl:B,updateUrl:y,schemaUrl:E,column:a.value,value:i[a.value]})})}function d(i){return b(this,null,function*(){if(!a.value){w("\u5F53\u524D\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u65E0\u6CD5\u5220\u9664");return}yield $(L,{column:a.value,value:i[a.value]}),p("\u5220\u9664\u6210\u529F"),s()})}function M(){m(!0,{selectUrl:C,insertUrl:B,updateUrl:y,schemaUrl:E})}return{registerTable:c,handleEdit:r,handleDelete:d,openRowModal:M,register:u,reload:s}}}),W={class:"p-4"},X=J(" \u6DFB\u52A0\u8BB0\u5F55 ");function Y(t,p,n,a,u,m){const c=_("a-button"),s=_("TableAction"),o=_("BasicTable"),r=_("ModalInserOrEdit");return V(),j("div",W,[v(o,{onRegister:t.registerTable,showTableSetting:""},{toolbar:g(()=>[v(c,{type:"primary",onClick:t.openRowModal},{default:g(()=>[X]),_:1},8,["onClick"])]),action:g(({record:d})=>[v(s,{actions:[{label:"\u7F16\u8F91",onClick:t.handleEdit.bind(null,d)},{label:"\u5220\u9664",icon:"ic:outline-delete-outline",popConfirm:{title:"\u662F\u5426\u5220\u9664\uFF1F",confirm:t.handleDelete.bind(null,d)}}]},null,8,["actions"])]),_:1},8,["onRegister"]),v(r,{onRegister:t.register,minHeight:300,onReload:t.reload},null,8,["onRegister","onReload"])])}var De=O(Q,[["render",Y]]);export{De as default};
