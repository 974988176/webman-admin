var F=(x,m,r)=>new Promise((c,f)=>{var t=o=>{try{i(r.next(o))}catch(u){f(u)}},y=o=>{try{i(r.throw(o))}catch(u){f(u)}},i=o=>o.done?c(o.value):Promise.resolve(o.value).then(t,y);i((r=r.apply(x,m)).next())});import{a as T,I as w,c as N,b as U,l as z,r as v,m as E,f as V,k as e,o as $,h as K,w as I,v as b,j as a,p as n,i as M,B as j,q,t as A,s as P,F as G,x as O}from"./index.6cd5baf8.js";import{F as R}from"./index.52ee3ac2.js";import"./index.c21d4698.js";import H from"./LoginFormTitle.458d226e.js";import{u as J,a as Q,L as W,b as X}from"./useLogin.f7a7c7c5.js";import"./index.63db07a3.js";import{C as Y,R as Z}from"./index.a4d3410c.js";import"./_baseIteratee.4c0536c1.js";const ee=["src"],ue=T({setup(x){const m=Y,r=Z,c=R.Item,f=w.Password,{t}=N(),{notification:y,createErrorModal:i}=O(),{prefixCls:o}=U("login"),u=z(),{getLoginState:B}=J(),{getFormRules:D}=Q(),_=v(),h=v(!1),S=v(""),l=E({account:"",password:"",captcha:""}),{validForm:L}=X(_),C=V(()=>e(B)===W.LOGIN);function g(){S.value="/app/admin/common/account/captcha?r="+new Date().getTime()}g();function k(){return F(this,null,function*(){const p=yield L();if(!!p)try{h.value=!0;const s=yield u.login({password:p.password,username:p.account,captcha:p.captcha,mode:"none"});s?y.success({message:t("sys.login.loginSuccessTitle"),description:`${t("sys.login.loginSuccessDesc")}: ${s.nickname}`,duration:3}):g()}catch(s){setTimeout(()=>{g()},2e3),i({title:t("sys.api.errorTip"),content:s.message||t("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${o}`)||document.body})}finally{h.value=!1}})}return(p,s)=>($(),K(G,null,[I(a(H,{class:"enter-x"},null,512),[[b,e(C)]]),I(a(e(R),{class:"p-4 enter-x",model:e(l),rules:e(D),ref_key:"formRef",ref:_,onKeypress:P(k,["enter"])},{default:n(()=>[a(e(c),{name:"account",class:"enter-x"},{default:n(()=>[a(e(w),{size:"large",value:e(l).account,"onUpdate:value":s[0]||(s[0]=d=>e(l).account=d),placeholder:e(t)("sys.login.userName"),class:"fix-auto-fill"},null,8,["value","placeholder"])]),_:1}),a(e(c),{name:"password",class:"enter-x"},{default:n(()=>[a(e(f),{size:"large",visibilityToggle:"",value:e(l).password,"onUpdate:value":s[1]||(s[1]=d=>e(l).password=d),placeholder:e(t)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),a(e(c),{name:"captcha",class:"enter-x"},{default:n(()=>[a(e(r),{type:"flex",justify:"space-between",align:"middle"},{default:n(()=>[a(e(m),null,{default:n(()=>[a(e(w),{size:"large",value:e(l).captcha,"onUpdate:value":s[2]||(s[2]=d=>e(l).captcha=d),placeholder:e(t)("sys.login.captcha"),class:"fix-auto-fill captcha-input",maxlength:5},null,8,["value","placeholder"])]),_:1}),a(e(m),null,{default:n(()=>[M("img",{src:S.value,onClick:g},null,8,ee)]),_:1})]),_:1})]),_:1}),a(e(c),{class:"enter-x"},{default:n(()=>[a(e(j),{type:"primary",size:"large",block:"",onClick:k,loading:h.value},{default:n(()=>[q(A(e(t)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules","onKeypress"]),[[b,e(C)]])],64))}});export{ue as default};
