var C=(c,j,F)=>new Promise((I,P)=>{var W=m=>{try{p(F.next(m))}catch(S){P(S)}},$=m=>{try{p(F.throw(m))}catch(S){P(S)}},p=m=>m.done?I(m.value):Promise.resolve(m.value).then(W,$);p((F=F.apply(c,j)).next())});import{aG as ce,r as E,a as re,co as de,a5 as k,aI as q,o as w,aJ as g,p as y,i as a,j as K,w as J,v as Y,b5 as Z,q as i,x as fe}from"./index.b9fee3a3.js";import{B as pe}from"./BasicForm.6307abba.js";import{C as me}from"./index.2258c945.js";import"./index.615ba6e0.js";import"./index.aef99e85.js";import{B as he,a as be}from"./index.c145b0a3.js";import{defaultTableSchemas as ve,fieldSchemas as T,getDefaultFieldSchemas as ye,defaultKeySchemas as V,controlSelectOptions as Be,typeToControl as _e}from"./tableData.d8d93b16.js";import{T as z}from"./table.0ba2e59f.js";import{a as $e,b as x}from"./common.548a9d5e.js";import"./index.efad70d8.js";import"./_baseIteratee.645293d8.js";import"./index.ab875217.js";import"./index.95528ccd.js";import"./index.c8f8cc06.js";import"./index.20ed4699.js";import"./index.befee6b0.js";import"./index.1e6e3f04.js";import"./index.44110336.js";import"./uniqBy.1d81fed5.js";import"./download.d7c230f8.js";import"./index.24b5a242.js";import"./useWindowSizeFn.3f9c25fc.js";import"./FullscreenOutlined.1c83f2c7.js";const Q=E(null),A=E(null),L=E(null),R=E(null);let ee=E("\u521B\u5EFA\u8868"),B="",H=[],M=[],b={};const N=E(3),O=E(0),Ce=re({components:{BasicForm:pe,Button:de,Card:me,BasicModal:he},emits:["reload","register"],setup(c,{emit:j}){const[F,{closeModal:I}]=be(t=>C(this,null,function*(){B=t?t.table:"",B&&(ee.value="\u4FEE\u6539\u8868");const o=B?yield $e(z.SCHEMA,{table:B}):{table:{}};H=[];for(let r of ve){let d=k(r);if(d.defaultValue=o.table[d.field]||"",B&&d.field=="name"){let h=k(d);h.field="old_name",h.componentProps={hidden:!0},h.colProps={span:0},h.label="",H.push(h)}H.push(d)}const e=Q.value;if(e==null||e.resetSchema(H),M=[],B)for(let r in o.columns){let d=o.columns[r];for(let h in T){let n=k(T[h]),u=n.field;if(n.defaultValue=d[u],u==="field"){let f=k(n);f.field=`old_${u}[${r}]`,f.label="",f.colProps={span:0},f.componentProps={hidden:!0},M.push(f)}n.field=n.slot?`${r}`:`${u}[${r}]`,M.push(n),N.value=Number(r)+1}}else M=ye();const l=A.value;if(l==null||l.resetSchema(M),B)for(let r in o.forms){let d=o.forms[r];b[d.field]=d}const s=R.value;s==null||s.resetSchema([]);const _=[];if(B)for(let r in o.keys){let d=o.keys[r];for(let h in V){let n=k(V[h]),u=n.field;if(n.defaultValue=d[u],B&&u==="name"){let f=k(n);f.field=`old_${u}[${r}]`,f.label="",f.colProps={span:0},f.componentProps={hidden:!0},_.push(f)}n.field=n.slot?`${r}`:`${u}[${r}]`,_.push(n),O.value=Number(r)+1}}if(s==null||s.resetSchema(_),s){const r=yield s.validate();Object.keys(r).length||G()}U()})),P=E("fieldTab"),{createMessage:W}=fe(),{success:$}=W,p=[{key:"fieldTab",tab:"\u5B57\u6BB5\u5C5E\u6027"},{key:"formTab",tab:"\u8868\u5355\u5C5E\u6027"},{key:"keyTab",tab:"\u7D22\u5F15"}];function m(t){return C(this,null,function*(){if(P.value=t,t==="formTab"){U();return}if(t=="keyTab"){const e=R.value;if(!e)return;const l=yield e.validate();Object.keys(l).length||G()}const o=yield D();for(let e of o)b[e.field]=e})}function S(){m("fieldTab")}function v(){return C(this,null,function*(){const t=A.value;if(!t)return[];const o=[];let e=-1;const l=yield t.validate();for(;e<Object.keys(l).length;)e++,l[`field[${e}]`]&&o.push({old_field:l[`old_field[${e}]`],field:l[`field[${e}]`],type:l[`type[${e}]`],comment:l[`comment[${e}]`]||null,length:l[`length[${e}]`]||null,default:l[`default[${e}]`]||null,nullable:l[`nullable[${e}]`]||!1,primary_key:l[`primary_key[${e}]`]||!1,auto_increment:l[`auto_increment[${e}]`]||!1});return o})}function D(){return C(this,null,function*(){const t=L.value;if(!t)return[];const o=[];let e=-1;const l=yield t.validate();for(;e<Object.keys(l).length;)e++,l[`field[${e}]`]&&o.push({field:l[`field[${e}]`],comment:l[`comment[${e}]`]||null,control:l[`control[${e}]`]||null,form_show:!!l[`form_show[${e}]`],list_show:!!l[`list_show[${e}]`],enable_sort:!!l[`enable_sort[${e}]`],readonly:!!l[`readonly[${e}]`],searchable:!!l[`searchable[${e}]`],search_type:l[`search_type[${e}]`]||"normal",control_args:l[`control_args[${e}]`]||null});return o})}function le(){return C(this,null,function*(){const t=R.value;if(!t)return[];const o=[];let e=-1;const l=yield t.validate();for(;e<Object.keys(l).length;)e++,l[`name[${e}]`]&&o.push({old_name:l[`old_name[${e}]`]||null,name:l[`name[${e}]`],columns:l[`columns[${e}]`]||null,type:l[`type[${e}]`]||null});return o})}function U(){var l,s,_,r,d,h;const t=L.value,o=A.value;if(!t||!o)return;const e=o.getFieldsValue();t.resetSchema([]);for(let n in e.field){let u=e.field[n],f=e.comment[n],X=e.type[n],ie=e.primary_key[n],ue=e.length[n];t.appendSchemaByField({field:`old_field[${n}]`,component:"Input",label:" ",colProps:{span:0},defaultValue:u,componentProps:{disabled:!0,hidden:!0}},""),t.appendSchemaByField({field:`field[${n}]`,component:"Input",label:" ",colProps:{span:4},defaultValue:u,componentProps:{disabled:!0}},""),t.appendSchemaByField({field:`comment[${n}]`,component:"Input",label:" ",colProps:{span:4},defaultValue:f,componentProps:{disabled:!0}},""),t.appendSchemaByField({field:`control[${n}]`,component:"Select",label:" ",colProps:{span:4},required:!0,componentProps:{options:Be},defaultValue:((l=b[u])==null?void 0:l.control)||_e(X)},""),t.appendSchemaByField({field:`form_show[${n}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:ie?!1:b[u]?b[u].form_show:!0},""),t.appendSchemaByField({field:`list_show[${n}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:b[u]?b[u].list_show:!0},""),t.appendSchemaByField({field:`enable_sort[${n}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:((s=b[u])==null?void 0:s.enable_sort)||!1},""),t.appendSchemaByField({field:`readonly[${n}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:((_=b[u])==null?void 0:_.readonly)||!1},""),t.appendSchemaByField({field:`searchable[${n}]`,component:"Checkbox",label:" ",colProps:{span:1},defaultValue:((r=b[u])==null?void 0:r.searchable)||!1},""),t.appendSchemaByField({field:`search_type[${n}]`,component:"Select",label:" ",colProps:{span:2},componentProps:{options:[{label:"\u666E\u901A\u67E5\u8BE2",value:"normal"},{label:"\u8303\u56F4\u67E5\u8BE2",value:"between"}]},defaultValue:((d=b[u])==null?void 0:d.search_type)||"\u666E\u901A\u67E5\u8BE2"},""),t.appendSchemaByField({field:`control_args[${n}]`,component:"Input",label:" ",colProps:{span:4},componentProps:{placeholder:""},defaultValue:((h=b[u])==null?void 0:h.control_args)||te(X,ue)},"")}}const te=(t,o)=>{if(t=="enum"){let e=[];for(let l of o.split(","))e.push(l+":"+l);return"options:"+e.join(",")}return""},ae=()=>C(this,null,function*(){try{const t=Q.value,o=L.value;if(!t||!o)return;const e=yield t.validate(),l=yield v(),s=yield D(),_=yield le();B?yield x(z.MODIFY,{table:e,columns:l,forms:s,keys:_}):yield x(z.CREATE,{table:e,columns:l,forms:s,keys:_}),I(),$("\u64CD\u4F5C\u6210\u529F"),j("reload")}catch(t){console.log(t)}});function oe(){const t=A.value;if(!!t){for(let o in T){let e=k(T[o]);e.field=e.field==="0"?String(N.value):`${e.field}[${N.value}]`,t.appendSchemaByField(e,"")}N.value++}}function ne(t){const o=A.value;if(!o)return;const e=[];for(let l in T){let s=T[l];e.push(s.field=="0"?String(t):`${s.field}[${t}]`)}o.removeSchemaByFiled(e),N.value--}function G(){return C(this,null,function*(){const t=R.value;if(!t)return;const o=yield v(),e=[];for(let l of o)e.push({label:l.field,value:l.field});for(let l in V){let s=k(V[l]);s.field==="columns"&&s.componentProps&&(s.componentProps.options=e),s.field=s.field==="0"?String(O.value):`${s.field}[${O.value}]`,t.appendSchemaByField(s,"")}O.value++})}function se(t){const o=R.value;if(!o)return;const e=[];for(let l in V){let s=V[l];e.push(s.field=="0"?String(t):`${s.field}[${t}]`)}o.removeSchemaByFiled(e),O.value--,O.value<0&&G()}return{tableElRef:Q,fieldElRef:A,formElRef:L,keyElRef:R,title:ee,handleSubmit:ae,tabListTitle:p,onTabChange:m,onTabClose:S,activeKey:P,del:ne,add:oe,addKey:G,delKey:se,register:F}}}),ke={class:"mt-3"},Ee=a("div",{class:"ant-row pb-2 b"},[a("div",{class:"ant-col-4 pl-2 align-center"}," \u5B57\u6BB5"),a("div",{class:"ant-col-4"}," \u5907\u6CE8"),a("div",{class:"ant-col-3 pl-2"},"\u957F\u5EA6/\u503C"),a("div",{class:"ant-col-4 pl-2"},"\u9ED8\u8BA4\u503C"),a("div",{class:"ant-col-4 pl-2"},"\u7C7B\u578B"),a("div",{class:"ant-col-1"},"\u4E3B\u952E"),a("div",{class:"ant-col-1"},"\u81EA\u589E"),a("div",{class:"ant-col-1"},"\u5141\u8BB8\u7A7A"),a("div",{class:"ant-col-2 pl-2"},"\u64CD\u4F5C")],-1),Fe=i("+"),Se=i("-"),we=a("div",{class:"ant-row pb-2 b"},[a("div",{class:"ant-col-4 pl-2"},[a("br"),i("\u5B57\u6BB5")]),a("div",{class:"ant-col-4"},[a("br"),i("\u5907\u6CE8")]),a("div",{class:"ant-col-4 pl-2"},[a("br"),i("\u63A7\u4EF6\u7C7B\u578B")]),a("div",{class:"ant-col-1 pl-2"},[i("\u8868\u5355"),a("br"),i("\u663E\u793A")]),a("div",{class:"ant-col-1 pl-2"},[i("\u5217\u8868"),a("br"),i("\u663E\u793A")]),a("div",{class:"ant-col-1"},[i("\u652F\u6301"),a("br"),i("\u6392\u5E8F")]),a("div",{class:"ant-col-1"},[i("\u662F\u5426"),a("br"),i("\u53EA\u8BFB")]),a("div",{class:"ant-col-1"},[i("\u662F\u5426"),a("br"),i("\u67E5\u8BE2")]),a("div",{class:"ant-col-2 pl-2"},[a("br"),i("\u67E5\u8BE2\u7C7B\u578B")]),a("div",{class:"ant-col-4 pl-2"},[a("br"),i("\u63A7\u4EF6\u53C2\u6570")])],-1),ge=i("+"),Pe=i("-"),Te=a("div",{class:"ant-row pb-2 b"},[a("div",{class:"ant-col-6 pl-2"},[a("br"),i("\u7D22\u5F15\u540D\u79F0")]),a("div",{class:"ant-col-6"},[a("br"),i("\u7D22\u5F15\u5B57\u6BB5")]),a("div",{class:"ant-col-6 pl-2"},[a("br"),i("\u7D22\u5F15\u7C7B\u578B")])],-1),Ve=i("+"),Ae=i("-");function Re(c,j,F,I,P,W){const $=q("BasicForm"),p=q("Button"),m=q("Card"),S=q("BasicModal");return w(),g(S,Z(c.$attrs,{destroyOnClose:"",onRegister:c.register,title:c.title,onOk:c.handleSubmit,afterClose:c.onTabClose}),{default:y(()=>[a("div",ke,[K($,{ref:"tableElRef",labelWidth:75,showActionButtonGroup:!1},null,512)]),K(m,Z({"tab-list":c.tabListTitle},c.$attrs,{"active-tab-key":c.activeKey,onTabChange:c.onTabChange}),{default:y(()=>[J(a("div",null,[Ee,K($,{ref:"fieldElRef",labelWidth:10,actionColOptions:{span:24},showResetButton:!1,showSubmitButton:!1},{add:y(({field:v})=>[Number(v)===0?(w(),g(p,{key:0,onClick:c.add},{default:y(()=>[Fe]),_:1},8,["onClick"])):(w(),g(p,{key:1,onClick:D=>c.del(v)},{default:y(()=>[Se]),_:2},1032,["onClick"]))]),_:1},512)],512),[[Y,c.activeKey==="fieldTab"]]),J(a("div",null,[we,K($,{ref:"formElRef",labelWidth:10,actionColOptions:{span:24},showResetButton:!1,showSubmitButton:!1},{add:y(({field:v})=>[Number(v)===0?(w(),g(p,{key:0,onClick:c.add},{default:y(()=>[ge]),_:1},8,["onClick"])):(w(),g(p,{key:1,onClick:D=>c.del(v)},{default:y(()=>[Pe]),_:2},1032,["onClick"]))]),_:1},512)],512),[[Y,c.activeKey==="formTab"]]),J(a("div",null,[Te,K($,{ref:"keyElRef",labelWidth:10,actionColOptions:{span:24},showResetButton:!1,showSubmitButton:!1},{add:y(({field:v})=>[Number(v)===0?(w(),g(p,{key:0,onClick:c.addKey},{default:y(()=>[Ve]),_:1},8,["onClick"])):(w(),g(p,{key:1,onClick:D=>c.delKey(v)},{default:y(()=>[Ae]),_:2},1032,["onClick"]))]),_:1},512)],512),[[Y,c.activeKey==="keyTab"]])]),_:1},16,["tab-list","active-tab-key","onTabChange"])]),_:1},16,["onRegister","title","onOk","afterClose"])}var ol=ce(Ce,[["render",Re]]);export{ol as default};
