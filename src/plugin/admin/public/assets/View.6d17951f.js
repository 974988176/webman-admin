var E=(s,h,i)=>new Promise((o,n)=>{var m=t=>{try{l(i.next(t))}catch(u){n(u)}},a=t=>{try{l(i.throw(t))}catch(u){n(u)}},l=t=>t.done?o(t.value):Promise.resolve(t.value).then(m,a);l((i=i.apply(s,h)).next())});import{B as S,u as P}from"./useTable.6943c6a3.js";import{x as U}from"./BasicForm.9a45028e.js";import{aG as x,r as $,a as N,d0 as O,dN as V,cE as G,ac as H,aI as _,o as L,h as j,j as T,p as C,cx as I,q,x as K}from"./index.a50f1195.js";import{T as d}from"./table.0ba2e59f.js";import{b as z}from"./index.d48a9464.js";import J from"./Update.eed4b7e0.js";import{a as Q,g as W,b as X}from"./common.d4a89cd7.js";import"./index.1803d30b.js";import"./useForm.15936411.js";import"./index.28ab2479.js";import"./index.36ffbcf0.js";import"./index.dad0e93f.js";import"./index.62d8a447.js";import"./useWindowSizeFn.fd0c6515.js";import"./useContentViewHeight.fbfd7f66.js";import"./ArrowLeftOutlined.de48d277.js";import"./transButton.fdcb0554.js";import"./index.65aab965.js";import"./index.3666b4e0.js";import"./index.84efda23.js";import"./_baseIteratee.0f5bf0e1.js";import"./index.08e2204b.js";import"./sortable.esm.c20789c1.js";import"./RedoOutlined.b803bb62.js";import"./FullscreenOutlined.4d9beddb.js";import"./scrollTo.405e18b2.js";import"./index.cd2734ff.js";import"./index.f1e4d655.js";import"./index.81823c62.js";import"./index.0e5d01f2.js";import"./index.734390c3.js";import"./uniqBy.71420ab8.js";import"./download.96873ec9.js";import"./index.da149197.js";import"./tree.02b777b4.js";let f="",F="",v="",b="",g="";const p=$({schemas:[]}),Y=N({components:{ModalInserOrEdit:J,BasicTable:S,TableAction:U},setup(){var B,A;const{createMessage:s}=K(),{success:h}=s,i=O(),o=(A=(B=i.params)==null?void 0:B.id)!=null?A:"",n=i.path;if(o){f=d.SELECT+"?table="+o,F=d.INSERT+"?table="+o,v=d.UPDATE+"?table="+o,g=d.DELETE+"?table="+o,b=d.SCHEMA+"?table="+o;const{setTitle:r}=V();r(`${o}\u8868`)}else f=`/app/admin${n}/select`,F=`/app/admin${n}/insert`,v=`/app/admin${n}/update`,g=`/app/admin${n}/delete`,b=`/app/admin${n}/schema`;const m=$([]),a=$("");G(()=>E(this,null,function*(){const r=yield Q(b),D=r.columns;for(let e of D)if(e.primary_key){a.value=e.field;break}const k=r.forms;p.value.schemas=[];for(let e of k)e.searchable&&(e.search_type=="between"?(p.value.schemas.push({field:`${e.field}[0]`,component:"Input",label:e.comment||e.field,colProps:{offset:1,span:5}}),p.value.schemas.push({field:`${e.field}[1]`,component:"Input",label:"\u3000\u5230",colProps:{span:5}})):p.value.schemas.push({field:e.field,component:"Input",label:e.comment||e.field,colProps:{offset:1,span:10}})),e.list_show&&m.value.push({dataIndex:e.field,title:e.comment||e.field,sorter:e.enable_sort});p.value.schemas.length||H(()=>{M({useSearchForm:!1})})}));const[l,{openModal:t}]=z(),[u,{reload:c,setProps:M}]=P({title:`${o}\u8868\u6570\u636E`,api:W(f),columns:m,useSearchForm:!0,bordered:!0,formConfig:p,actionColumn:{width:250,title:"Action",dataIndex:"action",slots:{customRender:"action"}}});function R(r){return E(this,null,function*(){if(!a.value){I("\u5F53\u524D\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u65E0\u6CD5\u7F16\u8F91");return}t(!0,{selectUrl:f,insertUrl:F,updateUrl:v,schemaUrl:b,column:a.value,value:r[a.value]})})}function w(r){return E(this,null,function*(){if(!a.value){I("\u5F53\u524D\u8868\u6CA1\u6709\u4E3B\u952E\uFF0C\u65E0\u6CD5\u5220\u9664");return}yield X(g,{column:a.value,value:r[a.value]}),h("\u5220\u9664\u6210\u529F"),c()})}function y(){t(!0,{selectUrl:f,insertUrl:F,updateUrl:v,schemaUrl:b})}return{registerTable:u,handleEdit:R,handleDelete:w,openRowModal:y,register:l,reload:c}}}),Z={class:"p-4"},ee=q(" \u6DFB\u52A0\u8BB0\u5F55 ");function te(s,h,i,o,n,m){const a=_("a-button"),l=_("TableAction"),t=_("BasicTable"),u=_("ModalInserOrEdit");return L(),j("div",Z,[T(t,{onRegister:s.registerTable,showTableSetting:""},{toolbar:C(()=>[T(a,{type:"primary",onClick:s.openRowModal},{default:C(()=>[ee]),_:1},8,["onClick"])]),action:C(({record:c})=>[T(l,{actions:[{label:"\u7F16\u8F91",onClick:s.handleEdit.bind(null,c)},{label:"\u5220\u9664",icon:"ic:outline-delete-outline",popConfirm:{title:"\u662F\u5426\u5220\u9664\uFF1F",confirm:s.handleDelete.bind(null,c)}}]},null,8,["actions"])]),_:1},8,["onRegister"]),T(u,{onRegister:s.register,minHeight:300,onReload:s.reload},null,8,["onRegister","onReload"])])}var Ne=x(Y,[["render",te]]);export{Ne as default};
